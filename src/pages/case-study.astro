---
import Base from '@/layouts/Base.astro';
import PageHeader from '@/components/PageHeader.astro';
import CallToAction from '@/components/CallToAction.astro';
import { getCollection, getEntry } from 'astro:content';

// Get the first case study for now (in a real app, you'd use dynamic routing)
const caseStudies = await getCollection('case-studies', ({ data }) => !data.draft);
const study = caseStudies[0];
const { Content } = await study.render();
---
<Base title="Case Study - Agile">
  
<PageHeader title="Case Study" />

<section class="section pt-3">
    <div class="container">
        <div class="lg:col-9 mx-auto">
            <img loading="lazy" class="mb-5 mx-auto" src={study.data.logo} alt={study.data.company}>
            <h2 class="text-center mb-14">{study.data.title}</h2>
        </div>
        <div class="lg:col-10 mx-auto">
            <img loading="lazy" width="1096" height="540" class="rounded-xl w-full" src={study.data.image} alt={study.data.company}>

            <div class="mt-6 lg:mt-14">
                <div class="row gy-4">
                    <div class="lg:col-6">
                        <div class="prose prose-lg">
                            <Content />
                        </div>
                    </div>
                    <div class="lg:col-6">
                        <div class="rounded-xl border-2 shadow border-primary/30">
                            <h6 class="px-7 py-4 border-b-2 border-primary/30 text-center">
                                Key Results from {study.data.company}
                            </h6>
                            <div class="px-7 py-6 space-y-6">
                                {study.data.results && study.data.results.map((result) => (
                                    <div class="text-center">
                                        <h2 class="text-primary mb-1">{result.value}</h2>
                                        <p class="text-light">{result.metric}</p>
                                    </div>
                                ))}
                                
                                <div class="pt-4 border-t border-primary/20">
                                    <p class="text-sm text-light mb-4">
                                        <strong>Industry:</strong> {study.data.industry || 'Technology'}
                                    </p>
                                    <p class="text-sm text-light">
                                        {study.data.excerpt}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- More Case Studies -->
<section class="section bg-theme-light">
    <div class="container">
        <div class="lg:col-6 mx-auto text-center mb-12">
            <h2>More Customer Success Stories</h2>
        </div>
        
        <div class="row g-4">
            {caseStudies.slice(0, 3).map((cs) => (
                <div class="lg:col-4 md:col-6">
                    <div class="bg-white rounded-xl overflow-hidden shadow hover:shadow-lg transition-all duration-300">
                        <img loading="lazy" class="w-full h-48 object-cover" src={cs.data.image} alt={cs.data.company}>
                        <div class="p-6">
                            <img loading="lazy" class="h-8 mb-4" src={cs.data.logo} alt={cs.data.company}>
                            <h4 class="mb-3">
                                <a class="hover:text-primary transition-colors" href="/case-study">{cs.data.title}</a>
                            </h4>
                            <p class="text-light text-sm mb-4">{cs.data.excerpt}</p>
                            <a href="/case-study" class="btn btn-outline-primary">Read More</a>
                        </div>
                    </div>
                </div>
            ))}
        </div>
    </div>
</section>

<CallToAction />

</Base>
