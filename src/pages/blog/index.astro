---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import PageHeader from '../../components/PageHeader.astro';
import CallToAction from '../../components/CallToAction.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
// Sort by date (newest first)
posts.sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

// Featured post is the first one
const featuredPost = posts[0];
const otherPosts = posts.slice(1);
---

<Layout title="Blog - Agile">
  <Header />
  
  <PageHeader title="Blog" />

  <!-- Blog -->
  <section class="section pt-5">
    <div class="container">
      <!-- Featured Post -->
      <div class="row items-center">
        <div class="lg:col-7">
          <div class="relative">
            <a href={`/blog/${featuredPost.slug}`}>
              <img loading="lazy" height="370" width="760" class="lg:mb-mb-0 mb-4 w-full rounded-lg"
                src={featuredPost.data.image || "/images/blog/1.png"}
                alt={featuredPost.data.title}>
            </a>
            <a href="#?"
              class="absolute right-3 top-3 rounded bg-dark px-[22px] py-2 text-sm font-semibold text-white">{featuredPost.data.category || "Business"}</a>
          </div>
        </div>
        <div class="lg:col">
          <h3 class="mb-4">
            <a class="transition-all duration-200 hover:text-secondary" href={`/blog/${featuredPost.slug}`}>{featuredPost.data.title}</a>
          </h3>
          <p class="mb-6">
            {featuredPost.data.excerpt || "Proven aptitude torate and build strong relationships withoProven aptitude to collaborate and build strong relationships with custoProven aptitude to collaborate and."}
          </p>
          <div class="flex items-center space-x-6">
            <img loading="lazy" class="h-10 w-10 flex-none rounded-full" src={featuredPost.data.authorImage || "/images/blog/profile.png"} alt="profile" />
            <p>
              <a class="transition-all duration-200 hover:text-primary" href="#?">{featuredPost.data.author || "Kathryn Murphy"}</a>
            </p>
          </div>
        </div>
      </div>

      <!-- Blog Posts Grid -->
      <div class="row gx-4">
        {otherPosts.map((post, index) => (
          <div class="md:col-6 lg:col-4">
            <div class="mt-12 h-full">
              <div class="relative">
                <a href={`/blog/${post.slug}`}>
                  <img loading="lazy" width="424" height="230" class="w-full rounded" src={post.data.image || `/images/blog/${index + 2}.png`}
                    alt={post.data.title}>
                </a>
                <a href="#?"
                  class="absolute right-3 top-3 rounded bg-dark px-[22px] py-2 text-sm font-semibold text-white">{post.data.category || "Business"}</a>
              </div>
              <h3 class="mb-2 mt-6 text-h3-sm">
                <a class="transition-all duration-200 hover:text-primary" href={`/blog/${post.slug}`}>{post.data.title}</a>
              </h3>
              <p class="mb-6">
                {post.data.excerpt || "Proven aptitude torate and build strong relationships withoProven aptitude to collaborate and build man strong relationships with custoProven aptitude."}
              </p>
              <a href="#?" class="flex items-center space-x-6">
                <img loading="lazy" class="h-10 w-10 flex-none rounded-full" src={post.data.authorImage || "/images/blog/profile.png"} alt="profile">
                <p>{post.data.author || "Kathryn Murphy"}</p>
              </a>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>
  <!-- /Blog -->

  <CallToAction title="Get started 7 days free trial" />

  <Footer />
</Layout>
